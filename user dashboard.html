<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Professional Finance Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
<style>
body, html { 
  margin:0; 
  padding:0; 
  font-family:'Segoe UI',sans-serif; 
  background:#f5f7fa; 
  color:#333; 
}
body.dark { 
  background:#1e1e2f; 
  color:#ddd; 
}
header { 
  display:flex; 
  justify-content:space-between; 
  align-items:center; 
  padding:15px 30px; 
  background:rgb(227,88,111); 
  color:#fff; 
  box-shadow:0 3px 6px rgba(0,0,0,0.1);
}
header h1 { 
  font-size:22px; 
  display:flex; 
  align-items:center; 
  gap:10px; 
}
header .header-actions { 
  display:flex; 
  gap:10px; 
  align-items:center; 
}
header button { 
  padding:6px 12px; 
  border:none; 
  border-radius:6px; 
  cursor:pointer; 
  color:#fff; 
  font-weight:bold; 
}
.logout-btn { 
  background:black; 
}
.logout-btn:hover { 
  background:#d32f2f; 
}
.toggle-mode-btn { 
  background:black; 
}
.toggle-mode-btn:hover { 
  background:#0d47a1; 
}
nav { 
  display:flex; 
  justify-content:center; 
  background:#ddd; 
  gap:10px; 
  flex-wrap:wrap; 
  padding:5px; 
}
nav button { 
  flex:1; 
  min-width:120px; 
  padding:10px; 
  border:none; 
  background:none; 
  color:black; 
  font-size:14px; 
  cursor:pointer; 
  display:flex; 
  flex-direction:column; 
  align-items:center; 
  gap:5px; 
  transition:0.3s; 
  border-radius:6px; 
}
nav button:hover, nav button.active { 
  background:#0d47a1; 
  color:#fff; 
}
.container { 
  padding:20px; 
  max-width:1200px; 
  margin:auto; 
}
.summary-box { 
  display:flex; 
  justify-content:space-between; 
  gap:15px; 
  flex-wrap:wrap; 
  margin-bottom:20px; 
}
.box { 
  background:#fff; 
  flex:1; 
  min-width:180px; 
  padding:20px; 
  border-radius:12px; 
  box-shadow:0 2px 8px rgba(0,0,0,0.1); 
  text-align:center; 
  margin-bottom:10px; 
}
form { 
  background:#fff; 
  padding:20px; 
  border-radius:12px; 
  box-shadow:0 2px 8px rgba(0,0,0,0.1); 
  margin-bottom:20px; 
}
form input, form select, form button { 
  width:100%; 
  padding:10px; 
  margin:8px 0; 
  border-radius:6px; 
  border:1px solid #ccc; 
  font-size:14px; 
}
form button { 
  background:#1976d2; 
  color:#fff; 
  border:none; 
  cursor:pointer; 
  transition:0.3s; 
}
form button:hover { 
  background:#0d47a1; 
}
.section { 
  display:none; 
  animation:fadeIn 0.5s; 
}
.active-section { 
  display:block; 
}
@keyframes fadeIn { 
  from{opacity:0;} to{opacity:1;} 
}
.alert { 
  padding:10px; 
  margin:10px 0; 
  border-radius:6px; 
  color:#fff; 
  font-weight:bold; 
  background:#e53935; 
}
canvas { 
  background:#fff; 
  padding:10px; 
  border-radius:12px; 
  box-shadow:0 2px 8px rgba(0,0,0,0.1); 
  margin:20px 0; 
}
#totalIncome{ 
  color:#4caf50; 
  font-weight:bold; 
  font-size:20px; 
}
#totalExpense{ 
  color:#e53935; 
  font-weight:bold; 
  font-size:20px; 
}
#balance{ 
  color:#1976d2; 
  font-weight:bold; 
  font-size:20px; 
}
table { 
  width:100%; 
  border-collapse:collapse; 
  background:#fff; 
  border-radius:12px; 
  overflow:hidden; 
  box-shadow:0 2px 8px rgba(0,0,0,0.1); 
}
th, td { 
  border:1px solid #ddd; 
  padding:8px; 
  text-align:center; 
  font-size:14px; 
}
th { 
  background:#1976d2; 
  color:#fff; 
}
.download-btn { 
  background:#43a047; 
  color:white; 
  border:none; 
  padding:10px 15px; 
  border-radius:6px; 
  cursor:pointer; 
}
.download-btn:hover { 
  background:#2e7d32; 
}
.password-wrapper { 
  position:relative; 
}
.password-wrapper i { 
  position:absolute; 
  right:10px; 
  top:50%; 
  transform:translateY(-50%); 
  cursor:pointer; 
  color:#555; 
}
@media(max-width:768px){ .summary-box{flex-direction:column;} 
nav{flex-direction:column;} 
}
.user-profile { 
  display:flex; 
  align-items:center; 
  gap:8px; 
  background:rgba(255,255,255,0.2); 
  padding:5px 10px; 
  border-radius:20px; 
}
.user-profile .profile-pic { 
  width:35px; 
  height:35px; 
  border-radius:50%; 
  object-fit:cover; 
  border:2px solid #fff; 
}
#usernameDisplay { 
  font-weight:bold; 
  color:#fff; 
}
.progress-bar { 
  height:20px; 
  border-radius:6px; 
  background:#eee; 
  margin-top:8px; 
  overflow:hidden; 
}
.progress-bar-fill { 
  height:100%; 
  width:0%; 
  color:#fff; 
  text-align:right; 
  padding-right:5px; 
  line-height:20px; 
  border-radius:6px; 
  transition: width 0.5s ease-in-out; 
}
.chart-container { 
  width:100%; 
  max-width:600px; 
  margin:auto; 
  height:400px; 
}
.logo-container {
  display: flex;
  align-items: center;
  gap: 10px; 
  padding: 10px;
}
.logo-container img {
  width: 60px;
  height: 60px;
  border-radius: 8px;
}
.logo-container h1 {
  font-family: Arial, sans-serif;
  font-size: 24px;
  color: #333;
  margin: 0;
}
.date-filter { 
  display:flex; 
  justify-content:center; 
  align-items:center; 
  gap:20px; 
  margin-bottom:20px; 
  background:#fff; 
  padding:15px; 
  border-radius:12px; 
  box-shadow:0 2px 8px rgba(0,0,0,0.1); 
}
.date-filter button { 
  background:#1976d2; 
  color:#fff; 
  border:none; 
  padding:10px 15px; 
  border-radius:6px; 
  cursor:pointer; 
}
.date-filter button:hover { 
  background:#0d47a1; 
}
.date-filter h3 { 
  margin:0; 
  font-size:18px; 
}
</style>
</head>
<body>
<header>
  <div class="logo-container">
  <img src="https://thumbs.dreamstime.com/b/bar-chart-icon-four-ascending-black-bars-blue-line-arrow-pointing-upward-symbolizing-financial-growth-performance-393289063.jpg" alt="Logo" >
  <h1>Finance Dashboard</h1>
  </div>
  <div class="header-actions">
    <div class="user-profile">
      <img src="https://cdn-icons-png.flaticon.com/512/456/456212.png" alt="Profile" class="profile-pic">
      <span id="usernameDisplay">User</span>
    </div>
    <button class="toggle-mode-btn" onclick="toggleMode()"><i class="fas fa-moon"></i></button>
    <button class="logout-btn" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Logout</button>
  </div>
</header>
<nav>
  <button class="active" onclick="showSection(event,'transactions')"><i class="fas fa-plus-circle"></i> Add Transactions</button>
  <button onclick="showSection(event,'goals')"><i class="fas fa-bullseye"></i> Set Goals</button>
  <button onclick="showSection(event,'reports')"><i class="fas fa-chart-bar"></i> Reports</button>
  <button onclick="showSection(event,'allTransactions')"><i class="fas fa-list"></i> All Transactions</button>
  <button onclick="showSection(event,'settings')"><i class="fas fa-cog"></i> Settings</button>
</nav>
<div class="container"> 
  <div class="date-filter">
    <button onclick="changeMonth(-1)" title="Previous Month"><i class="fas fa-chevron-left"></i></button>
    <h3 id="currentMonthYear"></h3>
    <button onclick="changeMonth(1)" title="Next Month"><i class="fas fa-chevron-right"></i></button>
  </div>
  <div class="summary-box">
    <div class="box"><h3>Income</h3><p id="totalIncome">₹0</p></div>
    <div class="box"><h3>Expenses</h3><p id="totalExpense">₹0</p></div>
    <div class="box"><h3>Balance</h3><p id="balance">₹0</p></div>
  </div>
  <div id="transactions" class="section active-section">
    <form id="transactionForm">
      <h3>Add Transaction</h3>
      <input type="number" id="amount" placeholder="Amount" required min="0.01" step="0.01">
      <select id="type" required>
        <option value="">Select Type</option>
        <option value="Income">Income</option>
        <option value="Expense">Expense</option>
      </select>
      <select id="incomeType" style="display:none;">
        <option value="">Select Income Type</option>
        <option>Salary</option>
        <option>Bonus</option>
        <option>Freelance</option>
        <option>Investment Income</option>
        <option>Interest Income</option>
        <option>Rental Income</option>
      </select>
      <select id="category" style="display:none;">
        <option value="">Select Expense Category</option>
        <option>Food</option>
        <option>Rent</option>
        <option>Shopping</option>
        <option>Transport</option>
        <option>Utilities</option>
        <option>Entertainment</option>
        <option>Health Care</option>
        <option>Lent Money</option>
        <option>Borrowed Money</option>
        <option>Groceries</option>
        <option>Books & Learning Materials</option>
        <option>Retirement Savings</option>
        <option>Insurance Premiums</option>
        <option>Beauty / Personal Care / Salon</option>
        <option>House Maintenance / Repairs</option>
        <option>Home Appliances / Electronics</option>
        <option>Child Expenses / School Fees</option>
        <option>Events & Celebrations</option>
        <option>Family Expenses</option>
      </select>
      <input type="text" id="reason" placeholder="Reason / Description" required>
      <input type="date" id="date" required>
      <button type="submit"><i class="fas fa-plus"></i> Add Transaction</button>
    </form>
  </div>
  <div id="goals" class="section">
    <form id="goalForm">
      <h3>Set Monthly Goals</h3>
      <input type="number" id="goalAmount" placeholder="Overall Monthly Expense Goal">
      <select id="categoryGoalSelect">
        <option value="">Select Category (optional)</option>
      </select>
      <input type="number" id="categoryGoalAmount" placeholder="Category Monthly Goal">
      <button type="submit"><i class="fas fa-bullseye"></i> Save Goal</button>
    </form>
    <h3>Goals Progress for <span id="goalMonthDisplay"></span></h3>
    <div id="goalSummary"></div>
  </div>
  <div id="reports" class="section">
    <h3>Expense Chart (Filtered)</h3>
    <canvas id="expenseBarChart" style="max-height:400px;"></canvas>
    <h3>Income vs Expense Chart (Filtered)</h3>
    <canvas id="incomeExpenseChart" style="max-height:500px;"></canvas>
  </div>
  <div id="allTransactions" class="section">
    <h3>All Transactions (Filtered)</h3>
    <button class="download-btn" onclick="downloadCSV()"><i class="fas fa-file-csv"></i> Download ALL Transactions CSV</button>
    <table>
      <thead><tr><th>Date</th><th>Category</th><th>Reason</th><th>Amount</th><th>Type</th><th>Actions</th></tr></thead>
      <tbody id="transactionTable"></tbody>
    </table>
  </div>
  <div id="settings" class="section">
    <form id="settingsForm">
      <h4>Change Username</h4>
      <input type="text" id="newUsername" placeholder="Enter new username">
      <h4>Change Password</h4>
      <div class="password-wrapper">
        <input type="password" id="newPassword" placeholder="New Password">
        <i class="fas fa-eye" onclick="togglePassword('newPassword',this)"></i>
      </div>
      <div class="password-wrapper">
        <input type="password" id="confirmPassword" placeholder="Confirm Password">
        <i class="fas fa-eye" onclick="togglePassword('confirmPassword',this)"></i>
      </div>
      <h4>Edit Personal Details</h4>
      <input type="text" id="phone" placeholder="phone">
      <input type="text" id="city" placeholder="City">
      <button type="submit"><i class="fas fa-save"></i> Save Changes</button>
    </form>
  </div>
</div>
<script>
const allCategories = [
  "Food","Rent","Shopping","Transport","Utilities","Entertainment","Health Care",
  "Lent Money","Borrowed Money","Groceries","Books & Learning Materials","Retirement Savings",
  "Insurance Premiums","Beauty / Personal Care / Salon","House Maintenance / Repairs",
  "Home Appliances / Electronics","Child Expenses / School Fees","Events & Celebrations","Family Expenses"
];
const barColors = ["#FF6384","#36A2EB","#FFCE56","#4BC0C0","#9966FF","#FF9F40","#8DD1E1","#FFB6C0","#C0C0C0","#FFD700","#00FA9A","#DC143C","#00CED1","#FF4500","#ADFF2F","#6A5ACD","#FF1493","#20B2AA","#7B68EE","#FF6347"];
let users = JSON.parse(localStorage.getItem('users')) || [];
localStorage.setItem('users', JSON.stringify(users));
let currentUser = JSON.parse(localStorage.getItem('currentUser')) || {email:'user@example.com',name:"User",transactions:[],goal:0,categoryGoals:{},details:{}, isBlocked: false}; 
let transactions = currentUser.transactions || [];
if (currentUser.isBlocked) {
    alert("Your account has been blocked by the Administrator and you cannot access the dashboard.");
    localStorage.removeItem('currentUser'); 
    window.location.href = "user login.html"; 
    throw new Error("User Blocked");
}
let monthlyGoals = currentUser.monthlyGoals || {};
let personalDetails = currentUser.details || {};
document.getElementById("phone").value = personalDetails.phone || "";
document.getElementById("city").value = personalDetails.city || "";
document.getElementById("usernameDisplay").textContent = currentUser.name;
let currentFilterDate = new Date(); 
function formatDateFilterDisplay(){
  const options = { year: 'numeric', month: 'long' };
  const dateString = currentFilterDate.toLocaleDateString('en-US', options);
  document.getElementById("currentMonthYear").textContent = dateString;
  document.getElementById("goalMonthDisplay").textContent = dateString;
}
function getFilteredTransactions() {
    const year = currentFilterDate.getFullYear();
    const month = currentFilterDate.getMonth(); 
    
    return transactions.filter(t => {
        const tDate = new Date(t.date + 'T00:00:00'); 
        return tDate.getFullYear() === year && tDate.getMonth() === month;
    });
}
function changeMonth(delta) {
    currentFilterDate.setMonth(currentFilterDate.getMonth() + delta);
    updateDashboard(); 
}
const categoryDropdown = document.getElementById("categoryGoalSelect");
allCategories.forEach(c=>{
  const opt = document.createElement("option");
  opt.textContent = c;
  categoryDropdown.appendChild(opt);
});
function showSection(e,sectionId){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active-section'));
  document.getElementById(sectionId).classList.add('active-section');
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  e.currentTarget.classList.add('active');
}
function logout(){ 
    let index = users.findIndex(u => u.email === currentUser.email);
    if(index !== -1){
        users[index] = currentUser;
    } else {
        users.push(currentUser);
    }
    localStorage.setItem('users', JSON.stringify(users));
    localStorage.removeItem('currentUser'); 
    alert("Logged out successfully."); 
    window.location.href = "user login.html";
}
function toggleMode(){document.body.classList.toggle("dark");}
function togglePassword(id,icon){ const input=document.getElementById(id); input.type=input.type==="password"?"text":"password"; icon.classList.toggle("fa-eye-slash");}
document.getElementById("type").addEventListener("change", e=>{
  document.getElementById("incomeType").style.display=e.target.value==="Income"?"block":"none";
  document.getElementById("category").style.display=e.target.value==="Expense"?"block":"none";
});
document.getElementById("transactionForm").onsubmit = e=>{
  e.preventDefault(); 
  const amountValue = parseFloat(document.getElementById("amount").value);
  const type=document.getElementById("type").value;
  if (type === "Expense") {
      const filteredTransactions = getFilteredTransactions();
      const income = filteredTransactions.filter(t=>t.type==="Income").reduce((a,b)=>a+b.amount,0);
      const expense = filteredTransactions.filter(t=>t.type==="Expense").reduce((a,b)=>a+b.amount,0);
      const currentBalance = income - expense;     
      if (amountValue > currentBalance) {
          alert(`Transaction declined: Insufficient funds for the current month. Your remaining monthly balance (₹${currentBalance.toFixed(2)}) is lower than the expense amount (₹${amountValue.toFixed(2)}).`);
          return; 
      }
  }
  const category=type==="Expense"?document.getElementById("category").value:document.getElementById("incomeType").value;
  transactions.push({type,category,amount:amountValue,reason:document.getElementById("reason").value,date:document.getElementById("date").value});
  saveUser();
  e.target.reset();
  updateDashboard();
};
document.getElementById("goalForm").onsubmit = e=>{
    e.preventDefault();
    const currentMonthYearKey = `${currentFilterDate.getMonth()}-${currentFilterDate.getFullYear()}`;
    if (!monthlyGoals[currentMonthYearKey]) {
        monthlyGoals[currentMonthYearKey] = { overall: 0, categories: {} };
    }
    const g=parseFloat(document.getElementById("goalAmount").value);
    if(!isNaN(g)&&g>0) monthlyGoals[currentMonthYearKey].overall = g;
    const c=document.getElementById("categoryGoalSelect").value;
    const cg=parseFloat(document.getElementById("categoryGoalAmount").value);
    if(c && !isNaN(cg) && cg>0) monthlyGoals[currentMonthYearKey].categories[c] = cg;
    saveUser();
    updateDashboard();
    e.target.reset();
};
function saveUser(){ 
  currentUser.transactions=transactions;
  currentUser.monthlyGoals = monthlyGoals;
  currentUser.details=personalDetails;
  let index = users.findIndex(u => u.email === currentUser.email);
  if(index !== -1){
      users[index] = currentUser;
  } else {
      users.push(currentUser);
  }
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
}
function updateDashboard(){
  formatDateFilterDisplay(); 
  const filteredTransactions = getFilteredTransactions(); 
  const income = filteredTransactions.filter(t=>t.type==="Income").reduce((a,b)=>a+b.amount,0);
  const expense = filteredTransactions.filter(t=>t.type==="Expense").reduce((a,b)=>a+b.amount,0);
  document.getElementById("totalIncome").textContent="₹"+income.toFixed(2);
  document.getElementById("totalExpense").textContent="₹"+expense.toFixed(2);
  document.getElementById("balance").textContent="₹"+(income-expense).toFixed(2);
  updateGoalSummary(filteredTransactions);
  populateTransactionTable(); 
  renderCharts(filteredTransactions);
}
function updateGoalSummary(filteredTransactions){
  let html = "";
  const currentMonthYearKey = `${currentFilterDate.getMonth()}-${currentFilterDate.getFullYear()}`;
    const monthGoals = monthlyGoals[currentMonthYearKey] || { overall: 0, categories: {} };
    const overallGoal = monthGoals.overall;
    const categoryGoals = monthGoals.categories;
  if(overallGoal){
    const spent = filteredTransactions.filter(t=>t.type==="Expense").reduce((a,b)=>a+b.amount,0);
    const percent = Math.min((spent/overallGoal)*100,100).toFixed(2);
    const color = spent > overallGoal ? "gold" : "#4caf50";
    if(spent > overallGoal){
      html += `<div class="alert">⚠️ You have exceeded your overall monthly expense goal by ₹${(spent-overallGoal).toFixed(2)}</div>`;
    }
    html += `<div class="box">
      <strong>Overall Goal:</strong> ₹${overallGoal.toFixed(2)} | Spent: ₹${spent.toFixed(2)} | Remaining: ₹${Math.max(overallGoal-spent,0).toFixed(2)}
      <div class="progress-bar"><div class="progress-bar-fill" style="width:${percent}%;background:${color}">${percent}%</div></div>
    </div>`;
  }
  Object.keys(categoryGoals).forEach(cat=>{
    const catSpent = filteredTransactions.filter(t=>t.type==="Expense" && t.category===cat).reduce((a,b)=>a+b.amount,0);
    const percent = Math.min((catSpent/categoryGoals[cat])*100,100).toFixed(2);
    const color = catSpent>categoryGoals[cat]?"gold":"#2196f3";
    if(catSpent>categoryGoals[cat]){
      html += `<div class="alert">⚠️ You have exceeded your goal for ${cat} by ₹${(catSpent-categoryGoals[cat]).toFixed(2)}</div>`;
    }
    html += `<div class="box">
      <strong>${cat} Goal:</strong> ₹${categoryGoals[cat].toFixed(2)} | Spent: ₹${catSpent.toFixed(2)} | Remaining: ₹${Math.max(categoryGoals[cat]-catSpent,0).toFixed(2)}
      <div class="progress-bar"><div class="progress-bar-fill" style="width:${percent}%;background:${color}">${percent}%</div></div>
    </div>`;
  });

  document.getElementById("goalSummary").innerHTML=html;
}
function editTransaction(index){
  const t = transactions[index];
  const newAmount = prompt(`Edit amount for ${t.category} (${t.type}):`, t.amount);
  if(newAmount !== null && !isNaN(parseFloat(newAmount)) && parseFloat(newAmount) > 0){ 
    const amountValue = parseFloat(newAmount);
    if (t.type === "Expense") {
        const filteredTransactions = getFilteredTransactions();
        const monthTransactions = transactions.filter(tr => {
            const tDate = new Date(tr.date + 'T00:00:00');
            return tDate.getFullYear() === currentFilterDate.getFullYear() && tDate.getMonth() === currentFilterDate.getMonth();
        });
        const income = monthTransactions.filter(tr => tr.type === "Income").reduce((a,b)=>a+b.amount,0);
        const expense = monthTransactions.filter(tr => tr.type === "Expense" && tr !== t).reduce((a,b)=>a+b.amount,0);
        const newBalance = income - (expense + amountValue);
        if (newBalance < 0) {
            alert(`Edit declined: The new expense amount (₹${amountValue.toFixed(2)}) would cause the current month's balance to go negative. Current balance before applying edit: ₹${(income - expense).toFixed(2)}.`);
            return;
        }
    }
    transactions[index].amount = amountValue;
    saveUser();
    updateDashboard();
  } else if (newAmount !== null) {
      alert("Amount must be a positive number.");
  }
}
function populateTransactionTable(){
  const tbody = document.getElementById("transactionTable");
  tbody.innerHTML = "";
  const transactionsWithIndex = transactions.map((t, index) => ({ t, index }));
  const year = currentFilterDate.getFullYear();
  const month = currentFilterDate.getMonth();
  const filteredIndices = transactionsWithIndex
    .filter(item => {
        const tDate = new Date(item.t.date + 'T00:00:00');
        return tDate.getFullYear() === year && tDate.getMonth() === month;
    });
  filteredIndices.forEach(item => {
    const t = item.t;
    const i = item.index; 
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${t.date}</td>
      <td>${t.category}</td>
      <td>${t.reason}</td>
      <td>₹${t.amount.toFixed(2)}</td>
      <td>${t.type}</td>
      <td>
        <button onclick="editTransaction(${i})">Edit</button>
        <button onclick="deleteTransaction(${i})">Delete</button>
      </td>
    `;
    tbody.appendChild(tr);
  });
}
function deleteTransaction(index){
  if(confirm("Are you sure you want to delete this transaction?")){
    transactions.splice(index, 1);
    saveUser();
    updateDashboard();
  }
}
function downloadCSV(){
  let csv = "Date,Category,Reason,Amount,Type\n";
  transactions.forEach(t=>{ 
    csv += `${t.date},${t.category},${t.reason},${t.amount.toFixed(2)},${t.type}\n`;
  });
  const blob = new Blob([csv], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href=url; a.download="all_transactions.csv"; a.click();
  URL.revokeObjectURL(url);
}
let expenseBarChart, incomeExpenseChart;
function renderCharts(filteredTransactions){
  const expenseData = allCategories.map(c=>filteredTransactions.filter(t=>t.type==="Expense" && t.category===c).reduce((a,b)=>a+b.amount,0));
  const ctx = document.getElementById("expenseBarChart").getContext("2d");
  if(expenseBarChart) expenseBarChart.destroy();
  expenseBarChart = new Chart(ctx,{
    type:"bar",
    data:{ labels:allCategories, datasets:[{label:"Expense by Category (Filtered)", data:expenseData, backgroundColor:barColors}]},
    options:{ responsive:true, plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }
  });
  const income = filteredTransactions.filter(t=>t.type==="Income").reduce((a,b)=>a+b.amount,0);
  const expense = filteredTransactions.filter(t=>t.type==="Expense").reduce((a,b)=>a+b.amount,0);
  const ctx2 = document.getElementById("incomeExpenseChart").getContext("2d");
  if(incomeExpenseChart) incomeExpenseChart.destroy();
  incomeExpenseChart = new Chart(ctx2,{
    type:"doughnut",
    data:{ labels:["Income (Filtered)","Expense (Filtered)"], datasets:[{data:[income,expense], backgroundColor:["#4caf50","#e53935"]}]},
    options:{ responsive:true }
  });
}
document.getElementById("settingsForm").onsubmit=e=>{
  e.preventDefault();
  const newName = document.getElementById("newUsername").value;
  if(newName) currentUser.name=newName;
  const np=document.getElementById("newPassword").value;
  const cp=document.getElementById("confirmPassword").value;
  if(np && cp && np===cp) currentUser.password=np;
  personalDetails.phone=document.getElementById("phone").value;
  personalDetails.city=document.getElementById("city").value;
  saveUser();
  document.getElementById("usernameDisplay").textContent=currentUser.name;
  alert("Settings updated successfully!");
};
updateDashboard();
</script>
</body>
</html>



